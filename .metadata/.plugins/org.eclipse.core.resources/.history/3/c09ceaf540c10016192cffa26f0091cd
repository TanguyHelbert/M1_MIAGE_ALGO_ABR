package proj;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.ArrayList;

public class TabABR {
	private String file;
	private ArrayList<Case> tabr;
	
	public TabABR(String file) {
		this.file = file;
		this.tabr = new ArrayList<>();
		analyseFichier();
	}
	
	private void analyseFichier(){
		Case c;
		this.intervalle = new int[2];
		this.abr = new ArbreBinaireRecherche();
		String ligne = "";
		String[] interArbre;
		String inter = "";
		String[] valInter;
		String arbre = "";
		String[] valArbre;
		int maxBorne = 0;
		int indexInterv = 0;
		
		try{
			// Parcours pour les intervalles
			InputStream ips=new FileInputStream(this.file); 
			InputStreamReader ipsr=new InputStreamReader(ips);
			BufferedReader br=new BufferedReader(ipsr);
						
			while ((ligne=br.readLine())!=null){
				interArbre = ligne.split(";");	// Récupération de la ligne de texte splitté
				inter = interArbre[0];			// Récupération de la partie intervalle
				valInter = inter.split(":");	// Splitt de la liste d'intervalle par :
				c = new Case(Integer.parseInt(valInter[0]),Integer.parseInt(valInter[1]));
				if(this.tabr.size()==0){
					this.tabr.add(c);
				} else 
					System.out.println("derniere val : " + this.tabr.get(this.allInter.size()-1)[1]);
					// Vérification de l'ordonnement croissant sur l'intervalle précédent
					this.tabr.add(c);
				}
				
				
				
				this.intervalle = new int[2];	// Ré-initialisation de l'intervalle
				this.intervalle[0] = Integer.parseInt(valInter[0]);
				this.intervalle[1] = Integer.parseInt(valInter[1]);
				
				// Ajout dans tous les intervalles
				if(this.allInter.size()==0){
					this.allInter.add(this.intervalle);
				} else {
					System.out.println("derniere val : " + this.allInter.get(this.allInter.size()-1)[1]);
					// Vérification de l'ordonnement croissant sur l'intervalle précédent
					if(this.allInter.get(this.allInter.size()-1)[1] > this.intervalle[0]) {
						this.intervalle[0] = this.allInter.get(this.allInter.size()-1)[1] + 1;
						if(this.intervalle[0] > this.intervalle[1])
							this.intervalle[1]++;
					}
					this.allInter.add(this.intervalle);
				}
				for(int i = 0 ; i < this.allInter.size() ; i++){
					System.out.println("intervalles : " + this.allInter.get(i)[0] + " ; " + this.allInter.get(i)[1]);
				}
			}
			br.close(); 
			
			// Parcours pour les arbres
			ips=new FileInputStream(this.fi); 
			ipsr=new InputStreamReader(ips);
			br=new BufferedReader(ipsr);
			
			indexInterv = 0;
			while ((ligne=br.readLine())!=null){
				interArbre = ligne.split(";");
				arbre = interArbre[1];
				valArbre = arbre.split(":");
				maxBorne = valArbre.length -1;
				for (int i = maxBorne ; i >= 0; i--){
					if(i == maxBorne)
						this.abr = new ArbreBinaireRecherche();
					if(Integer.parseInt(valArbre[i]) >= this.allInter.get(indexInterv)[0] && Integer.parseInt(valArbre[i]) <= this.allInter.get(indexInterv)[1])
						this.abr.insere(Integer.parseInt(valArbre[i]));
					else
						System.out.println("Nombre " + valArbre[i] + " n'appartient pas à l'intervalle : [" + this.intervalle[0] + " ; " + this.intervalle[1] + "]");
				} 
				System.out.println(this.abr.getRacine().toString());
				indexInterv++;
			}
			br.close();
		} catch (Exception e){
			System.out.println(e.toString());
		}
	}	

	public String getfile() {
		return file;
	}

	public void setfile(String file) {
		this.file = file;
	}

	public ArrayList<Case> getTabr() {
		return tabr;
	}

	public void setTabr(ArrayList<Case> tabr) {
		this.tabr = tabr;
	}
}
